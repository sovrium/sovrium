{
  "$id": "format.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Date Display Format",
  "description": "Display format for date values. Controls how dates are presented to users, not how they are stored. Storage always uses ISO 8601 (YYYY-MM-DD). Common formats: YYYY-MM-DD (ISO), MM/DD/YYYY (US), DD-MM-YYYY (European).",
  "type": "string",
  "default": "YYYY-MM-DD",
  "examples": ["YYYY-MM-DD", "MM/DD/YYYY", "DD-MM-YYYY", "DD/MM/YYYY", "YYYY/MM/DD"],
  "x-specs": [
    {
      "id": "APP-FIELD-DATE-FORMAT-001",
      "title": "Accept valid date format pattern",
      "given": "date field with format: 'MM/DD/YYYY' (US format)",
      "when": "field migration creates DATE column",
      "then": "PostgreSQL stores in ISO 8601 (YYYY-MM-DD), application displays using format pattern",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE events (id SERIAL PRIMARY KEY, name VARCHAR(255), event_date DATE)",
            "INSERT INTO events (name, event_date) VALUES ('Launch', '2024-12-31'), ('Conference', '2024-01-15')"
          ],
          "fieldConfig": {
            "name": "event_date",
            "type": "date",
            "format": "MM/DD/YYYY"
          }
        },
        "assertions": [
          {
            "description": "Column uses DATE type (ISO 8601 storage)",
            "executeQuery": "SELECT data_type FROM information_schema.columns WHERE table_name='events' AND column_name='event_date'",
            "expected": { "data_type": "date" }
          },
          {
            "description": "Date stored in ISO format (YYYY-MM-DD)",
            "executeQuery": "SELECT event_date FROM events WHERE name = 'Launch'",
            "expected": { "event_date": "2024-12-31" }
          },
          {
            "description": "Application transforms to display format (MM/DD/YYYY)",
            "displayFormat": "MM/DD/YYYY",
            "executeQuery": "SELECT event_date FROM events WHERE name = 'Launch'",
            "expectedDisplay": "12/31/2024"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-FORMAT-002",
      "title": "Use default format when not specified",
      "given": "date field without format property",
      "when": "user views date value",
      "then": "date displayed in default ISO 8601 format (YYYY-MM-DD)",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE tasks (id SERIAL PRIMARY KEY, title VARCHAR(255), due_date DATE DEFAULT CURRENT_DATE)",
            "INSERT INTO tasks (title, due_date) VALUES ('Task 1', '2024-06-15')"
          ],
          "fieldConfig": {
            "name": "due_date",
            "type": "date"
          }
        },
        "assertions": [
          {
            "description": "Default format is YYYY-MM-DD",
            "executeQuery": "SELECT due_date FROM tasks WHERE title = 'Task 1'",
            "expected": { "due_date": "2024-06-15" }
          },
          {
            "description": "Display format defaults to YYYY-MM-DD (same as storage)",
            "displayFormat": "YYYY-MM-DD",
            "executeQuery": "SELECT due_date FROM tasks WHERE title = 'Task 1'",
            "expectedDisplay": "2024-06-15"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-FORMAT-003",
      "title": "Reject invalid format pattern",
      "given": "date field with invalid format pattern",
      "when": "field configuration validation runs",
      "then": "validation error returned with message 'Invalid date format pattern'",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "created_date",
            "type": "date",
            "format": "INVALID-FORMAT"
          }
        },
        "assertions": [
          {
            "description": "Invalid format pattern rejected",
            "validateConfig": true,
            "expectError": "Invalid date format pattern. Valid tokens: YYYY, MM, DD"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-FORMAT-004",
      "title": "Support European date format (DD-MM-YYYY)",
      "given": "date field with format: 'DD-MM-YYYY'",
      "when": "date '2024-12-25' retrieved",
      "then": "application displays as '25-12-2024'",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE holidays (id SERIAL PRIMARY KEY, name VARCHAR(255), holiday_date DATE)",
            "INSERT INTO holidays (name, holiday_date) VALUES ('Christmas', '2024-12-25')"
          ],
          "fieldConfig": {
            "name": "holiday_date",
            "type": "date",
            "format": "DD-MM-YYYY"
          }
        },
        "assertions": [
          {
            "description": "Storage remains ISO format",
            "executeQuery": "SELECT holiday_date FROM holidays WHERE name = 'Christmas'",
            "expected": { "holiday_date": "2024-12-25" }
          },
          {
            "description": "Display uses European format (DD-MM-YYYY)",
            "displayFormat": "DD-MM-YYYY",
            "executeQuery": "SELECT holiday_date FROM holidays WHERE name = 'Christmas'",
            "expectedDisplay": "25-12-2024"
          }
        ]
      }
    }
  ]
}
