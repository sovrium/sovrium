{
  "$id": "default.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Default Date Value",
  "description": "Default value for date field when no value is provided. Can be a static ISO 8601 date (YYYY-MM-DD) or dynamic keyword 'today' (PostgreSQL CURRENT_DATE). Applied automatically via DEFAULT constraint.",
  "type": "string",
  "examples": [
    "2024-12-31",
    "today",
    "2025-01-01"
  ],
  "x-specs": [
    {
      "id": "APP-FIELD-DATE-DEFAULT-001",
      "given": "date field with static default: '2025-01-01'",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT constraint provides '2025-01-01'",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE events (id SERIAL PRIMARY KEY, title VARCHAR(255), event_date DATE DEFAULT '2025-01-01')",
            "INSERT INTO events (title) VALUES ('New Year Party')"
          ],
          "fieldConfig": {
            "name": "event_date",
            "type": "date",
            "default": "2025-01-01"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT constraint with date",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='events' AND column_name='event_date'",
            "expected": {
              "column_default": "'2025-01-01'::date"
            }
          },
          {
            "description": "INSERT without value uses default date",
            "executeQuery": "SELECT event_date FROM events WHERE title = 'New Year Party'",
            "expected": {
              "event_date": "2025-01-01"
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-DEFAULT-002",
      "given": "date field with dynamic default: 'today' (CURRENT_DATE)",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT CURRENT_DATE provides current date",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE logs (id SERIAL PRIMARY KEY, message TEXT, log_date DATE DEFAULT CURRENT_DATE)",
            "INSERT INTO logs (message) VALUES ('System started')"
          ],
          "fieldConfig": {
            "name": "log_date",
            "type": "date",
            "default": "today"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT CURRENT_DATE constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='logs' AND column_name='log_date'",
            "expected": {
              "column_default": "CURRENT_DATE"
            }
          },
          {
            "description": "INSERT without value uses current date (dynamic)",
            "executeQuery": "SELECT log_date = CURRENT_DATE as is_today FROM logs WHERE message = 'System started'",
            "expected": {
              "is_today": true
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-DEFAULT-003",
      "given": "date field without default specified",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL inserts NULL",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE tasks (id SERIAL PRIMARY KEY, title VARCHAR(255), due_date DATE)",
            "INSERT INTO tasks (title) VALUES ('Todo item')"
          ],
          "fieldConfig": {
            "name": "due_date",
            "type": "date"
          }
        },
        "assertions": [
          {
            "description": "Column has no DEFAULT constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='tasks' AND column_name='due_date'",
            "expected": {
              "column_default": null
            }
          },
          {
            "description": "INSERT without value results in NULL",
            "executeQuery": "SELECT due_date FROM tasks WHERE title = 'Todo item'",
            "expected": {
              "due_date": null
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATE-DEFAULT-004",
      "given": "date field with default and explicit value",
      "when": "INSERT with specific date",
      "then": "PostgreSQL uses explicit value, ignoring default",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE appointments (id SERIAL PRIMARY KEY, client VARCHAR(255), appointment_date DATE DEFAULT CURRENT_DATE)",
            "INSERT INTO appointments (client, appointment_date) VALUES ('Alice', '2025-06-15')"
          ],
          "fieldConfig": {
            "name": "appointment_date",
            "type": "date",
            "default": "today"
          }
        },
        "assertions": [
          {
            "description": "Explicit value overrides default",
            "executeQuery": "SELECT appointment_date FROM appointments WHERE client = 'Alice'",
            "expected": {
              "appointment_date": "2025-06-15"
            }
          }
        ]
      }
    }
  ]
}
