{
  "$id": "default.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Status Field Default Value",
  "description": "Default status value when no value is provided during INSERT. PostgreSQL DEFAULT constraint with VARCHAR type for status tracking (similar to single-select but with workflow semantics).",
  "type": "string",
  "examples": ["todo", "in_progress", "done", "active", "archived"],
  "x-specs": [
    {
      "id": "APP-FIELD-STATUS-DEFAULT-001",
      "given": "status field with default: 'todo'",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT constraint provides default status",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE tasks (id SERIAL PRIMARY KEY, title VARCHAR(255), status VARCHAR(50) DEFAULT 'todo')",
            "INSERT INTO tasks (title) VALUES ('New Task')"
          ],
          "fieldConfig": {
            "name": "status",
            "type": "status",
            "options": [
              {
                "id": "todo",
                "value": "To Do",
                "color": "#gray"
              },
              {
                "id": "in_progress",
                "value": "In Progress",
                "color": "#blue"
              },
              {
                "id": "done",
                "value": "Done",
                "color": "#green"
              }
            ],
            "default": "todo"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT constraint with status",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='tasks' AND column_name='status'",
            "expected": {
              "column_default": "'todo'::character varying"
            }
          },
          {
            "description": "INSERT without value uses default status",
            "executeQuery": "SELECT status FROM tasks WHERE title = 'New Task'",
            "expected": {
              "status": "todo"
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-STATUS-DEFAULT-002",
      "given": "status field without default specified",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL inserts NULL",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE projects (id SERIAL PRIMARY KEY, name VARCHAR(255), status VARCHAR(50))",
            "INSERT INTO projects (name) VALUES ('Project A')"
          ],
          "fieldConfig": {
            "name": "status",
            "type": "status",
            "options": [
              {
                "id": "active",
                "value": "Active",
                "color": "#green"
              },
              {
                "id": "paused",
                "value": "Paused",
                "color": "#yellow"
              },
              {
                "id": "archived",
                "value": "Archived",
                "color": "#gray"
              }
            ]
          }
        },
        "assertions": [
          {
            "description": "Column has no DEFAULT constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='projects' AND column_name='status'",
            "expected": {
              "column_default": null
            }
          },
          {
            "description": "INSERT without value results in NULL",
            "executeQuery": "SELECT status FROM projects WHERE name = 'Project A'",
            "expected": {
              "status": null
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-STATUS-DEFAULT-003",
      "given": "status field with default and explicit value",
      "when": "INSERT with specific status",
      "then": "PostgreSQL uses explicit value, ignoring default",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE orders (id SERIAL PRIMARY KEY, customer VARCHAR(255), status VARCHAR(50) DEFAULT 'pending')",
            "INSERT INTO orders (customer, status) VALUES ('John Doe', 'completed')"
          ],
          "fieldConfig": {
            "name": "status",
            "type": "status",
            "options": [
              {
                "id": "pending",
                "value": "Pending",
                "color": "#yellow"
              },
              {
                "id": "processing",
                "value": "Processing",
                "color": "#blue"
              },
              {
                "id": "completed",
                "value": "Completed",
                "color": "#green"
              }
            ],
            "default": "pending"
          }
        },
        "assertions": [
          {
            "description": "Explicit value overrides default",
            "executeQuery": "SELECT status FROM orders WHERE customer = 'John Doe'",
            "expected": {
              "status": "completed"
            }
          }
        ]
      }
    }
  ]
}
