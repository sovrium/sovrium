{
  "$id": "default.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "default",
  "type": "number",
  "x-specs": [
    {
      "id": "APP-FIELD-DECIMAL-DEFAULT-001",
      "given": "decimal field with default: 0.0",
      "when": "field migration creates column with DEFAULT constraint",
      "then": "PostgreSQL automatically sets value to 0.0 when not provided",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE accounts (id SERIAL PRIMARY KEY, name VARCHAR(255), balance DECIMAL(15,2) DEFAULT 0.0)",
            "INSERT INTO accounts (name) VALUES ('Account 1'), ('Account 2')"
          ],
          "fieldConfig": {
            "name": "balance",
            "type": "decimal",
            "default": 0.0
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='accounts' AND column_name='balance'",
            "expected": {
              "column_default": "0.0"
            }
          },
          {
            "description": "Default value applied when not provided",
            "executeQuery": "SELECT balance FROM accounts WHERE name = 'Account 1'",
            "expected": {
              "balance": 0.0
            }
          },
          {
            "description": "Explicit value overrides default",
            "executeQuery": "INSERT INTO accounts (name, balance) VALUES ('Account 3', 150.50) RETURNING balance",
            "expected": {
              "balance": 150.5
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DECIMAL-DEFAULT-002",
      "given": "decimal field with default: 19.99 (price)",
      "when": "INSERT without value",
      "then": "PostgreSQL uses default value 19.99",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE items (id SERIAL PRIMARY KEY, name VARCHAR(255), price DECIMAL(10,2) DEFAULT 19.99)",
            "INSERT INTO items (name) VALUES ('Item 1')"
          ],
          "fieldConfig": {
            "name": "price",
            "type": "decimal",
            "default": 19.99
          }
        },
        "assertions": [
          {
            "description": "Default value is 19.99",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='items' AND column_name='price'",
            "expected": {
              "column_default": "19.99"
            }
          },
          {
            "description": "Default applied to inserted record",
            "executeQuery": "SELECT price FROM items WHERE name = 'Item 1'",
            "expected": {
              "price": 19.99
            }
          },
          {
            "description": "Explicit 0.0 allowed (overrides default)",
            "executeQuery": "INSERT INTO items (name, price) VALUES ('Item 2', 0.0) RETURNING price",
            "expected": {
              "price": 0.0
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DECIMAL-DEFAULT-003",
      "given": "decimal field with no default specified",
      "when": "INSERT without value",
      "then": "PostgreSQL uses NULL (if nullable) or rejects (if required)",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE measurements (id SERIAL PRIMARY KEY, weight DECIMAL(10,3))",
            "INSERT INTO measurements (id) VALUES (1)"
          ],
          "fieldConfig": {
            "name": "weight",
            "type": "decimal"
          }
        },
        "assertions": [
          {
            "description": "No DEFAULT constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='measurements' AND column_name='weight'",
            "expected": {
              "column_default": null
            }
          },
          {
            "description": "NULL used when no default and no value",
            "executeQuery": "SELECT weight FROM measurements WHERE id = 1",
            "expected": {
              "weight": null
            }
          },
          {
            "description": "Explicit value succeeds",
            "executeQuery": "INSERT INTO measurements (weight) VALUES (125.750) RETURNING weight",
            "expected": {
              "weight": 125.75
            }
          }
        ]
      }
    }
  ]
}
