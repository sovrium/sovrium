{
  "$id": "format.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DateTime Display Format",
  "description": "Display format for datetime values. Controls how datetimes are presented to users, not how they are stored. Storage always uses ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ). Common formats: YYYY-MM-DD HH:mm (ISO-like), MM/DD/YYYY hh:mm A (US 12-hour), DD-MM-YYYY HH:mm (European 24-hour).",
  "type": "string",
  "default": "YYYY-MM-DD HH:mm",
  "examples": [
    "YYYY-MM-DD HH:mm",
    "MM/DD/YYYY hh:mm A",
    "DD-MM-YYYY HH:mm:ss",
    "YYYY-MM-DD HH:mm:ss",
    "MM/DD/YYYY hh:mm:ss A"
  ],
  "x-specs": [
    {
      "id": "APP-FIELD-DATETIME-FORMAT-001",
      "title": "Accept valid US 12-hour datetime format",
      "given": "datetime field with format: 'MM/DD/YYYY hh:mm A'",
      "when": "field migration creates TIMESTAMPTZ column",
      "then": "PostgreSQL stores in ISO 8601, application displays using format pattern",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE appointments (id SERIAL PRIMARY KEY, title VARCHAR(255), scheduled_at TIMESTAMPTZ)",
            "INSERT INTO appointments (title, scheduled_at) VALUES ('Doctor Visit', '2024-12-31 14:30:00+00'), ('Meeting', '2024-01-15 09:15:00+00')"
          ],
          "fieldConfig": {
            "name": "scheduled_at",
            "type": "datetime",
            "format": "MM/DD/YYYY hh:mm A"
          }
        },
        "assertions": [
          {
            "description": "Column uses TIMESTAMPTZ type (ISO 8601 storage)",
            "executeQuery": "SELECT data_type FROM information_schema.columns WHERE table_name='appointments' AND column_name='scheduled_at'",
            "expected": {
              "data_type": "timestamp with time zone"
            }
          },
          {
            "description": "Datetime stored in ISO format",
            "executeQuery": "SELECT scheduled_at FROM appointments WHERE title = 'Doctor Visit'",
            "expected": {
              "scheduled_at": "2024-12-31T14:30:00.000Z"
            }
          },
          {
            "description": "Application transforms to US 12-hour format",
            "displayFormat": "MM/DD/YYYY hh:mm A",
            "executeQuery": "SELECT scheduled_at FROM appointments WHERE title = 'Doctor Visit'",
            "expectedDisplay": "12/31/2024 02:30 PM",
            "expectError": "validation error"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATETIME-FORMAT-002",
      "title": "Use default ISO-like format when not specified",
      "given": "datetime field without format property",
      "when": "user views datetime value",
      "then": "datetime displayed in default format (YYYY-MM-DD HH:mm)",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE audit_logs (id SERIAL PRIMARY KEY, action VARCHAR(255), created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP)",
            "INSERT INTO audit_logs (action, created_at) VALUES ('User Login', '2024-06-15 16:45:30+00')"
          ],
          "fieldConfig": {
            "name": "created_at",
            "type": "datetime"
          }
        },
        "assertions": [
          {
            "description": "Default format is YYYY-MM-DD HH:mm (ISO-like)",
            "displayFormat": "YYYY-MM-DD HH:mm",
            "executeQuery": "SELECT created_at FROM audit_logs WHERE action = 'User Login'",
            "expectedDisplay": "2024-06-15 16:45",
            "expectError": "validation error"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATETIME-FORMAT-003",
      "title": "Reject invalid format pattern",
      "given": "datetime field with invalid format pattern",
      "when": "field configuration validation runs",
      "then": "validation error returned with message 'Invalid datetime format pattern'",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "updated_at",
            "type": "datetime",
            "format": "INVALID-FORMAT"
          }
        },
        "assertions": [
          {
            "description": "Invalid format pattern rejected",
            "validateConfig": true,
            "expectError": "Invalid datetime format pattern. Valid tokens: YYYY, MM, DD, HH, hh, mm, ss, SSS, A"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATETIME-FORMAT-004",
      "title": "Support European 24-hour datetime format",
      "given": "datetime field with format: 'DD-MM-YYYY HH:mm:ss'",
      "when": "datetime '2024-12-25T18:30:45.000Z' retrieved",
      "then": "application displays as '25-12-2024 18:30:45'",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE deliveries (id SERIAL PRIMARY KEY, package_id VARCHAR(255), delivered_at TIMESTAMPTZ)",
            "INSERT INTO deliveries (package_id, delivered_at) VALUES ('PKG-001', '2024-12-25 18:30:45+00')"
          ],
          "fieldConfig": {
            "name": "delivered_at",
            "type": "datetime",
            "format": "DD-MM-YYYY HH:mm:ss"
          }
        },
        "assertions": [
          {
            "description": "Storage uses ISO format with timezone",
            "executeQuery": "SELECT delivered_at FROM deliveries WHERE package_id = 'PKG-001'",
            "expected": {
              "delivered_at": "2024-12-25T18:30:45.000Z"
            }
          },
          {
            "description": "Display uses European format with seconds",
            "displayFormat": "DD-MM-YYYY HH:mm:ss",
            "executeQuery": "SELECT delivered_at FROM deliveries WHERE package_id = 'PKG-001'",
            "expectedDisplay": "25-12-2024 18:30:45",
            "expectError": "validation error"
          }
        ]
      }
    }
  ]
}
