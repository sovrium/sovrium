{
  "$id": "default.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Default DateTime Value",
  "description": "Default value for datetime field when no value is provided. Can be a static ISO 8601 datetime or dynamic keyword 'now' (PostgreSQL CURRENT_TIMESTAMP). Commonly used for created_at, updated_at timestamps.",
  "type": "string",
  "examples": ["2024-12-31T15:00:00.000Z", "now", "2025-01-01T00:00:00.000Z"],
  "x-specs": [
    {
      "id": "APP-FIELD-DATETIME-DEFAULT-001",
      "given": "datetime field with static default: '2025-01-01 00:00:00'",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT constraint provides specific timestamp",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE milestones (id SERIAL PRIMARY KEY, name VARCHAR(255), milestone_at TIMESTAMP DEFAULT '2025-01-01 00:00:00')",
            "INSERT INTO milestones (name) VALUES ('Launch Date')"
          ],
          "fieldConfig": {
            "name": "milestone_at",
            "type": "datetime",
            "default": "2025-01-01T00:00:00.000Z"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT constraint with timestamp",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='milestones' AND column_name='milestone_at'",
            "expected": { "column_default": "'2025-01-01 00:00:00'::timestamp without time zone" }
          },
          {
            "description": "INSERT without value uses default timestamp",
            "executeQuery": "SELECT milestone_at FROM milestones WHERE name = 'Launch Date'",
            "expected": { "milestone_at": "2025-01-01T00:00:00.000Z" }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATETIME-DEFAULT-002",
      "given": "datetime field with dynamic default: 'now' (CURRENT_TIMESTAMP)",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT CURRENT_TIMESTAMP provides current timestamp",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE posts (id SERIAL PRIMARY KEY, title VARCHAR(255), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)",
            "INSERT INTO posts (title) VALUES ('Hello World')"
          ],
          "fieldConfig": {
            "name": "created_at",
            "type": "datetime",
            "default": "now"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT CURRENT_TIMESTAMP constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='posts' AND column_name='created_at'",
            "expected": { "column_default": "CURRENT_TIMESTAMP" }
          },
          {
            "description": "INSERT without value uses current timestamp (dynamic)",
            "executeQuery": "SELECT (created_at BETWEEN CURRENT_TIMESTAMP - INTERVAL '5 seconds' AND CURRENT_TIMESTAMP) as is_recent FROM posts WHERE title = 'Hello World'",
            "expected": { "is_recent": true }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-DATETIME-DEFAULT-003",
      "given": "datetime field without default specified",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL inserts NULL",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE drafts (id SERIAL PRIMARY KEY, content TEXT, published_at TIMESTAMP)",
            "INSERT INTO drafts (content) VALUES ('Draft content')"
          ],
          "fieldConfig": {
            "name": "published_at",
            "type": "datetime"
          }
        },
        "assertions": [
          {
            "description": "Column has no DEFAULT constraint",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='drafts' AND column_name='published_at'",
            "expected": { "column_default": null }
          },
          {
            "description": "INSERT without value results in NULL",
            "executeQuery": "SELECT published_at FROM drafts WHERE content = 'Draft content'",
            "expected": { "published_at": null }
          }
        ]
      }
    }
  ]
}
