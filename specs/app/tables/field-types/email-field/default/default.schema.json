{
  "$id": "default.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Email Field Default Value",
  "description": "Default email value for this field when no value is provided during INSERT. PostgreSQL DEFAULT constraint with VARCHAR type for email addresses.",
  "type": "string",
  "x-specs": [
    {
      "id": "APP-FIELD-EMAIL-DEFAULT-001",
      "given": "email field with default: 'noreply@example.com'",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL DEFAULT constraint provides default email",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE users (id SERIAL PRIMARY KEY, username VARCHAR(255), email VARCHAR(255) DEFAULT 'noreply@example.com')",
            "INSERT INTO users (username) VALUES ('alice')"
          ],
          "fieldConfig": {
            "name": "email",
            "type": "email",
            "default": "noreply@example.com"
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT constraint with email",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='users' AND column_name='email'",
            "expected": { "column_default": "'noreply@example.com'::character varying" }
          },
          {
            "description": "INSERT without value uses default email",
            "executeQuery": "SELECT email FROM users WHERE username = 'alice'",
            "expected": { "email": "noreply@example.com" }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-EMAIL-DEFAULT-002",
      "given": "email field without default specified",
      "when": "INSERT without value for this field",
      "then": "PostgreSQL inserts NULL",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE contacts (id SERIAL PRIMARY KEY, name VARCHAR(255), email VARCHAR(255))",
            "INSERT INTO contacts (name) VALUES ('Bob')"
          ],
          "fieldConfig": {
            "name": "email",
            "type": "email"
          }
        },
        "assertions": [
          {
            "description": "INSERT without value results in NULL",
            "executeQuery": "SELECT email FROM contacts WHERE name = 'Bob'",
            "expected": { "email": null }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-EMAIL-DEFAULT-003",
      "given": "email field with default and explicit value",
      "when": "INSERT with specific email address",
      "then": "PostgreSQL uses explicit value, ignoring default",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE members (id SERIAL PRIMARY KEY, name VARCHAR(255), email VARCHAR(255) DEFAULT 'info@example.com')",
            "INSERT INTO members (name, email) VALUES ('Charlie', 'charlie@custom.com')"
          ],
          "fieldConfig": {
            "name": "email",
            "type": "email",
            "default": "info@example.com"
          }
        },
        "assertions": [
          {
            "description": "Explicit value overrides default",
            "executeQuery": "SELECT email FROM members WHERE name = 'Charlie'",
            "expected": { "email": "charlie@custom.com" }
          }
        ]
      }
    }
  ]
}
