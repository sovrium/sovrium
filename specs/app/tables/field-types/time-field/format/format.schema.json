{
  "$id": "format.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Time Display Format",
  "description": "Display format for time values. Controls how times are presented to users, not how they are stored. Storage always uses ISO 8601 (HH:mm:ss or HH:mm:ss.sss). Common formats: HH:mm (24-hour), hh:mm A (12-hour with AM/PM), HH:mm:ss (24-hour with seconds).",
  "type": "string",
  "default": "HH:mm",
  "examples": [
    "HH:mm",
    "hh:mm A",
    "HH:mm:ss",
    "hh:mm:ss A",
    "HH:mm:ss.SSS"
  ],
  "x-specs": [
    {
      "id": "APP-FIELD-TIME-FORMAT-001",
      "title": "Accept valid 12-hour format pattern",
      "given": "time field with format: 'hh:mm A' (12-hour with AM/PM)",
      "when": "field migration creates TIME column",
      "then": "PostgreSQL stores in 24-hour format, application displays using format pattern",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE meetings (id SERIAL PRIMARY KEY, title VARCHAR(255), start_time TIME)",
            "INSERT INTO meetings (title, start_time) VALUES ('Standup', '09:15:00'), ('Lunch', '14:30:00')"
          ],
          "fieldConfig": {
            "name": "start_time",
            "type": "time",
            "format": "hh:mm A"
          }
        },
        "assertions": [
          {
            "description": "Column uses TIME type (24-hour storage)",
            "executeQuery": "SELECT data_type FROM information_schema.columns WHERE table_name='meetings' AND column_name='start_time'",
            "expected": {
              "data_type": "time without time zone"
            }
          },
          {
            "description": "Time stored in 24-hour format (HH:mm:ss)",
            "executeQuery": "SELECT start_time FROM meetings WHERE title = 'Lunch'",
            "expected": {
              "start_time": "14:30:00"
            }
          },
          {
            "description": "Application transforms to 12-hour format (hh:mm A)",
            "displayFormat": "hh:mm A",
            "executeQuery": "SELECT start_time FROM meetings WHERE title = 'Lunch'",
            "expectedDisplay": "02:30 PM",
            "expectError": "validation error"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-TIME-FORMAT-002",
      "title": "Use default 24-hour format when not specified",
      "given": "time field without format property",
      "when": "user views time value",
      "then": "time displayed in default 24-hour format (HH:mm)",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE schedules (id SERIAL PRIMARY KEY, activity VARCHAR(255), time TIME DEFAULT '12:00:00')",
            "INSERT INTO schedules (activity, time) VALUES ('Training', '16:45:00')"
          ],
          "fieldConfig": {
            "name": "time",
            "type": "time"
          }
        },
        "assertions": [
          {
            "description": "Default format is HH:mm (24-hour without seconds)",
            "displayFormat": "HH:mm",
            "executeQuery": "SELECT time FROM schedules WHERE activity = 'Training'",
            "expectedDisplay": "16:45",
            "expectError": "validation error"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-TIME-FORMAT-003",
      "title": "Reject invalid format pattern",
      "given": "time field with invalid format pattern",
      "when": "field configuration validation runs",
      "then": "validation error returned with message 'Invalid time format pattern'",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "arrival_time",
            "type": "time",
            "format": "INVALID-FORMAT"
          }
        },
        "assertions": [
          {
            "description": "Invalid format pattern rejected",
            "validateConfig": true,
            "expectError": "Invalid time format pattern. Valid tokens: HH, hh, mm, ss, SSS, A"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-TIME-FORMAT-004",
      "title": "Support format with seconds (HH:mm:ss)",
      "given": "time field with format: 'HH:mm:ss' (24-hour with seconds)",
      "when": "time '14:30:45' retrieved",
      "then": "application displays with seconds: '14:30:45'",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE logs (id SERIAL PRIMARY KEY, event VARCHAR(255), timestamp TIME)",
            "INSERT INTO logs (event, timestamp) VALUES ('System Start', '14:30:45')"
          ],
          "fieldConfig": {
            "name": "timestamp",
            "type": "time",
            "format": "HH:mm:ss"
          }
        },
        "assertions": [
          {
            "description": "Display includes seconds",
            "displayFormat": "HH:mm:ss",
            "executeQuery": "SELECT timestamp FROM logs WHERE event = 'System Start'",
            "expectedDisplay": "14:30:45",
            "expectError": "validation error"
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-TIME-FORMAT-005",
      "title": "Support format with milliseconds (HH:mm:ss.SSS)",
      "given": "time field with format: 'HH:mm:ss.SSS'",
      "when": "time '14:30:45.123' retrieved",
      "then": "application displays with milliseconds: '14:30:45.123'",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE performance_logs (id SERIAL PRIMARY KEY, operation VARCHAR(255), execution_time TIME(3))",
            "INSERT INTO performance_logs (operation, execution_time) VALUES ('API Call', '14:30:45.123')"
          ],
          "fieldConfig": {
            "name": "execution_time",
            "type": "time",
            "format": "HH:mm:ss.SSS"
          }
        },
        "assertions": [
          {
            "description": "Column stores milliseconds (TIME(3))",
            "executeQuery": "SELECT execution_time FROM performance_logs WHERE operation = 'API Call'",
            "expected": {
              "execution_time": "14:30:45.123"
            }
          },
          {
            "description": "Display includes milliseconds",
            "displayFormat": "HH:mm:ss.SSS",
            "executeQuery": "SELECT execution_time FROM performance_logs WHERE operation = 'API Call'",
            "expectedDisplay": "14:30:45.123",
            "expectError": "validation error"
          }
        ]
      }
    }
  ]
}
