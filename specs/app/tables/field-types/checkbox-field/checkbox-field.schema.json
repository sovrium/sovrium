{
  "$id": "checkbox-field.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Checkbox Field",
  "type": "object",
  "properties": {
    "id": {
      "$ref": "../../../common/definitions.schema.json#/definitions/id"
    },
    "name": {
      "$ref": "../../../common/definitions.schema.json#/definitions/name"
    },
    "required": {
      "$ref": "../common/required/required.schema.json"
    },
    "indexed": {
      "$ref": "../common/indexed/indexed.schema.json"
    },
    "type": {
      "type": "string",
      "const": "checkbox"
    },
    "default": {
      "$ref": "./default/default.schema.json"
    }
  },
  "description": "Boolean checkbox field for true/false values. Displays as a toggleable checkbox in forms and checkmark/cross in tables. Useful for status flags (active/inactive, published/draft), feature toggles, and yes/no questions. Supports default value. Cannot be required (defaults to false).",
  "required": ["id", "name", "type"],
  "additionalProperties": false,
  "x-specs": [
    {
      "id": "APP-FIELD-CHECKBOX-001",
      "given": "table configuration with checkbox field 'is_active'",
      "when": "field migration creates column",
      "then": "PostgreSQL BOOLEAN column is created",
      "validation": {
        "setup": {
          "executeQuery": "CREATE TABLE users (id SERIAL PRIMARY KEY)",
          "fieldConfig": {
            "id": 1,
            "name": "is_active",
            "type": "checkbox"
          }
        },
        "assertions": [
          {
            "description": "Column created as BOOLEAN type",
            "executeQuery": "SELECT column_name, data_type, is_nullable FROM information_schema.columns WHERE table_name='users' AND column_name='is_active'",
            "expected": {
              "column_name": "is_active",
              "data_type": "boolean",
              "is_nullable": "YES"
            }
          },
          {
            "description": "True value can be inserted",
            "executeQuery": "INSERT INTO users (is_active) VALUES (true) RETURNING is_active",
            "expected": {
              "is_active": true
            }
          },
          {
            "description": "False value can be inserted",
            "executeQuery": "INSERT INTO users (is_active) VALUES (false) RETURNING is_active",
            "expected": {
              "is_active": false
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-CHECKBOX-002",
      "given": "table 'features' with checkbox field 'enabled' and default value false",
      "when": "row inserted without providing enabled value",
      "then": "PostgreSQL applies DEFAULT value false",
      "validation": {
        "setup": {
          "executeQuery": "CREATE TABLE features (id SERIAL PRIMARY KEY, enabled BOOLEAN DEFAULT false)",
          "fieldConfig": {
            "id": 1,
            "name": "enabled",
            "type": "checkbox",
            "default": false
          }
        },
        "assertions": [
          {
            "description": "Column has DEFAULT value false",
            "executeQuery": "SELECT column_default FROM information_schema.columns WHERE table_name='features' AND column_name='enabled'",
            "expected": {
              "column_default": "false"
            }
          },
          {
            "description": "INSERT without enabled uses default false",
            "executeQuery": "INSERT INTO features (id) VALUES (DEFAULT) RETURNING enabled",
            "expected": {
              "enabled": false
            }
          },
          {
            "description": "Explicit true overrides default",
            "executeQuery": "INSERT INTO features (enabled) VALUES (true) RETURNING enabled",
            "expected": {
              "enabled": true
            }
          }
        ]
      }
    },
    {
      "id": "APP-FIELD-CHECKBOX-003",
      "given": "table 'settings' with required checkbox field 'accepted_terms'",
      "when": "NOT NULL constraint is applied",
      "then": "PostgreSQL enforces NOT NULL constraint",
      "validation": {
        "setup": {
          "executeQuery": "CREATE TABLE settings (id SERIAL PRIMARY KEY, accepted_terms BOOLEAN NOT NULL)"
        },
        "assertions": [
          {
            "description": "NOT NULL constraint enforced",
            "executeQuery": "SELECT is_nullable FROM information_schema.columns WHERE table_name='settings' AND column_name='accepted_terms'",
            "expected": {
              "is_nullable": "NO"
            }
          },
          {
            "description": "Valid boolean insertion succeeds",
            "executeQuery": "INSERT INTO settings (accepted_terms) VALUES (true) RETURNING accepted_terms",
            "expected": {
              "accepted_terms": true
            }
          },
          {
            "description": "NULL insertion fails",
            "executeQuery": "INSERT INTO settings (accepted_terms) VALUES (NULL)",
            "expectError": "violates not-null constraint"
          }
        ]
      }
    },
    {
      "id": "APP-CHECKBOX-FIELD-004",
      "given": "table 'tasks' with checkbox field 'completed'",
      "when": "boolean values are queried",
      "then": "PostgreSQL supports boolean filtering and counting",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE tasks (id SERIAL PRIMARY KEY, completed BOOLEAN DEFAULT false)",
            "INSERT INTO tasks (completed) VALUES (true), (false), (true), (false), (false)"
          ]
        },
        "assertions": [
          {
            "description": "Count completed tasks (true)",
            "executeQuery": "SELECT COUNT(*) as count FROM tasks WHERE completed = true",
            "expected": {
              "count": 2
            }
          },
          {
            "description": "Count incomplete tasks (false)",
            "executeQuery": "SELECT COUNT(*) as count FROM tasks WHERE completed = false",
            "expected": {
              "count": 3
            }
          },
          {
            "description": "Update boolean value",
            "executeQuery": "UPDATE tasks SET completed = true WHERE id = 2 RETURNING completed",
            "expected": {
              "completed": true
            }
          }
        ]
      }
    },
    {
      "id": "APP-CHECKBOX-FIELD-005",
      "given": "table configuration with checkbox field 'published', indexed=true",
      "when": "index is created on the boolean field",
      "then": "PostgreSQL btree index exists for fast boolean filtering",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE articles (id SERIAL PRIMARY KEY, published BOOLEAN DEFAULT false)",
            "CREATE INDEX idx_articles_published ON articles(published)"
          ],
          "fieldConfig": {
            "id": 1,
            "name": "published",
            "type": "checkbox",
            "indexed": true
          }
        },
        "assertions": [
          {
            "description": "Index exists in pg_indexes",
            "executeQuery": "SELECT indexname, tablename FROM pg_indexes WHERE indexname = 'idx_articles_published'",
            "expected": {
              "indexname": "idx_articles_published",
              "tablename": "articles"
            }
          },
          {
            "description": "Index uses btree for boolean filtering",
            "executeQuery": "SELECT indexdef FROM pg_indexes WHERE indexname = 'idx_articles_published'",
            "expected": {
              "indexdef": "CREATE INDEX idx_articles_published ON public.articles USING btree (published)"
            }
          }
        ]
      }
    }
  ]
}
