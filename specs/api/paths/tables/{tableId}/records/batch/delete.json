{
  "summary": "Batch delete records",
  "description": "Delete multiple records in a single transaction. All record IDs are validated before deletion. If any ID is invalid or not found, the entire operation is rolled back. Maximum 1000 records per request.",
  "operationId": "batchDeleteRecords",
  "tags": ["Records"],
  "parameters": [
    {
      "name": "tableId",
      "in": "path",
      "required": true,
      "description": "Table identifier (tbl_XXXXX)",
      "schema": {
        "type": "string",
        "pattern": "^tbl_[a-zA-Z0-9]+$"
      }
    }
  ],
  "requestBody": {
    "required": true,
    "content": {
      "application/json": {
        "schema": {
          "type": "object",
          "properties": {
            "ids": {
              "type": "array",
              "description": "Array of record IDs to delete (max 1000)",
              "minItems": 1,
              "maxItems": 1000,
              "items": {
                "type": "string",
                "pattern": "^rec_[a-zA-Z0-9]+$"
              }
            }
          },
          "required": ["ids"]
        },
        "example": {
          "ids": ["rec_001", "rec_002", "rec_003"]
        }
      }
    }
  },
  "responses": {
    "200": {
      "description": "Records deleted successfully",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "deleted": {
                "type": "integer",
                "description": "Number of records successfully deleted"
              }
            },
            "required": ["deleted"]
          },
          "example": {
            "deleted": 3
          }
        }
      }
    },
    "400": {
      "description": "Validation error - Invalid record ID format",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string",
                "enum": ["ValidationError"]
              },
              "message": {
                "type": "string"
              },
              "details": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "index": {
                      "type": "integer"
                    },
                    "field": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "example": {
            "error": "ValidationError",
            "message": "Invalid record ID format",
            "details": [
              {
                "index": 1,
                "field": "ids[1]",
                "message": "Must match pattern ^rec_[a-zA-Z0-9]+$"
              }
            ]
          }
        }
      }
    },
    "403": {
      "$ref": "../../../../../../components/responses/PermissionDenied.json"
    },
    "404": {
      "$ref": "../../../../../../components/responses/NotFound.json"
    },
    "413": {
      "description": "Payload too large - Exceeds 1000 record limit",
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "error": {
                "type": "string",
                "enum": ["PayloadTooLarge"]
              },
              "message": {
                "type": "string"
              }
            }
          },
          "example": {
            "error": "PayloadTooLarge",
            "message": "Batch size exceeds maximum of 1000 records"
          }
        }
      }
    },
    "500": {
      "$ref": "../../../../../../components/responses/InternalError.json"
    }
  },
  "x-specs": [
    {
      "id": "API-RECORDS-BATCH-009",
      "given": "table 'tbl_001' with 3 records (rec_001, rec_002, rec_003)",
      "when": "DELETE /api/tables/tbl_001/records/batch with ids=[rec_001, rec_002]",
      "then": "returns 200 with deleted=2, records are removed from database",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "example_field",
            "type": "text"
          }
        },
        "assertions": [
          {
            "description": "returns 200 with deleted=2, records are removed from database",
            "validateConfig": true,
            "expectError": null
          }
        ]
      }
    },
    {
      "id": "API-RECORDS-BATCH-010",
      "given": "table 'tbl_001' with record rec_001",
      "when": "DELETE /api/tables/tbl_001/records/batch with ids=[rec_001, rec_999] (rec_999 nonexistent)",
      "then": "returns 404 NotFound for rec_999, no records deleted (transaction rolled back)",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "example_field",
            "type": "text"
          }
        },
        "assertions": [
          {
            "description": "returns 404 NotFound for rec_999, no records deleted (transaction rolled back)",
            "validateConfig": true,
            "expectError": null
          }
        ]
      }
    },
    {
      "id": "API-RECORDS-BATCH-011",
      "given": "table 'tbl_001' exists",
      "when": "DELETE /api/tables/tbl_001/records/batch with 1001 IDs",
      "then": "returns 413 PayloadTooLarge",
      "validation": {
        "setup": {
          "fieldConfig": {
            "name": "example_field",
            "type": "text"
          }
        },
        "assertions": [
          {
            "description": "returns 413 PayloadTooLarge",
            "validateConfig": true,
            "expectError": null
          }
        ]
      }
    }
  ]
}
