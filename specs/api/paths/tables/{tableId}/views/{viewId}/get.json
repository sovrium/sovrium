{
  "summary": "Get view details",
  "description": "Returns the configuration for a specific view. Views are predefined in the table schema and are read-only via the API.",
  "operationId": "getTableView",
  "tags": ["views"],
  "parameters": [
    {
      "name": "tableId",
      "in": "path",
      "required": true,
      "description": "The ID of the table",
      "schema": {
        "type": "integer",
        "minimum": 1
      }
    },
    {
      "name": "viewId",
      "in": "path",
      "required": true,
      "description": "The ID of the view",
      "schema": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9_]*$"
      }
    }
  ],
  "responses": {
    "200": {
      "description": "View details",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "../../../../../components/schemas/View.json"
          },
          "examples": {
            "gridView": {
              "summary": "Simple grid view with filters",
              "value": {
                "id": "active_projects",
                "name": "Active Projects",
                "type": "grid",
                "filters": {
                  "operator": "OR",
                  "conditions": [
                    {
                      "field": "status",
                      "operator": "equals",
                      "value": "planning"
                    },
                    {
                      "field": "status",
                      "operator": "equals",
                      "value": "in-progress"
                    }
                  ]
                },
                "sorts": [
                  {
                    "field": "priority",
                    "direction": "desc"
                  },
                  {
                    "field": "created_at",
                    "direction": "desc"
                  }
                ],
                "isDefault": false
              }
            },
            "kanbanView": {
              "summary": "Kanban view with grouping",
              "value": {
                "id": "status_board",
                "name": "Status Board",
                "type": "kanban",
                "groupBy": {
                  "field": "status",
                  "direction": "asc"
                },
                "filters": {
                  "operator": "AND",
                  "conditions": [
                    {
                      "field": "archived",
                      "operator": "isFalse"
                    }
                  ]
                },
                "isDefault": false
              }
            },
            "calendarView": {
              "summary": "Calendar view with date field",
              "value": {
                "id": "project_timeline",
                "name": "Project Timeline",
                "type": "calendar",
                "fields": [
                  {
                    "name": "name",
                    "visible": true,
                    "order": 1
                  },
                  {
                    "name": "start_date",
                    "visible": true,
                    "order": 2
                  },
                  {
                    "name": "end_date",
                    "visible": true,
                    "order": 3
                  }
                ],
                "sorts": [
                  {
                    "field": "start_date",
                    "direction": "asc"
                  }
                ],
                "isDefault": false
              }
            }
          }
        }
      }
    },
    "404": {
      "description": "Table or view not found",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "../../../../../components/schemas/Error.json"
          },
          "examples": {
            "tableNotFound": {
              "summary": "Table not found",
              "value": {
                "error": "Table not found",
                "code": "TABLE_NOT_FOUND"
              }
            },
            "viewNotFound": {
              "summary": "View not found",
              "value": {
                "error": "View not found",
                "code": "VIEW_NOT_FOUND"
              }
            }
          }
        }
      }
    }
  },
  "x-specs": [
    {
      "id": "API-TABLES-VIEWS-GET-001",
      "given": "A table with a specific view configured",
      "when": "User requests view details by viewId",
      "then": "View configuration should be returned with all properties",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE projects (id SERIAL PRIMARY KEY, name VARCHAR(255) NOT NULL, status VARCHAR(50))"
          ],
          "tableConfig": {
            "id": 1,
            "name": "projects",
            "views": [
              {
                "id": "active_projects",
                "name": "Active Projects",
                "type": "grid",
                "filters": {
                  "operator": "OR",
                  "conditions": [
                    { "field": "status", "operator": "equals", "value": "planning" },
                    { "field": "status", "operator": "equals", "value": "in-progress" }
                  ]
                },
                "sorts": [{ "field": "name", "direction": "asc" }],
                "isDefault": false
              }
            ]
          },
          "apiRequest": {
            "method": "GET",
            "endpoint": "/api/tables/1/views/active_projects",
            "headers": { "Authorization": "Bearer test_token" },
            "pathParams": { "tableId": 1, "viewId": "active_projects" }
          }
        },
        "assertions": [
          {
            "description": "Returns 200 with complete view configuration",
            "expectedStatus": 200,
            "expectedSchema": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "type": { "type": "string" },
                "filters": { "type": "object" },
                "sorts": { "type": "array" },
                "isDefault": { "type": "boolean" }
              },
              "required": ["id", "name", "type"]
            },
            "validateResponseData": {
              "id": "active_projects",
              "name": "Active Projects",
              "type": "grid"
            }
          }
        ]
      }
    },
    {
      "id": "API-TABLES-VIEWS-GET-002",
      "given": "A table without the requested view",
      "when": "User requests non-existent view",
      "then": "404 Not Found error should be returned with 'View not found' message",
      "validation": {
        "setup": {
          "executeQuery": ["CREATE TABLE projects (id SERIAL PRIMARY KEY)"],
          "tableConfig": {
            "id": 1,
            "name": "projects",
            "views": []
          },
          "apiRequest": {
            "method": "GET",
            "endpoint": "/api/tables/1/views/non_existent",
            "headers": { "Authorization": "Bearer test_token" },
            "pathParams": { "tableId": 1, "viewId": "non_existent" }
          }
        },
        "assertions": [
          {
            "description": "Returns 404 when view does not exist",
            "expectedStatus": 404,
            "expectedSchema": {
              "type": "object",
              "properties": {
                "error": { "type": "string" },
                "code": { "type": "string" }
              },
              "required": ["error"]
            },
            "validateResponseData": {
              "error": "View not found",
              "code": "VIEW_NOT_FOUND"
            }
          }
        ]
      }
    },
    {
      "id": "API-TABLES-VIEWS-GET-003",
      "given": "A non-existent table ID",
      "when": "User requests view details",
      "then": "404 Not Found error should be returned with 'Table not found' message",
      "validation": {
        "setup": {
          "executeQuery": [],
          "apiRequest": {
            "method": "GET",
            "endpoint": "/api/tables/9999/views/active_projects",
            "headers": { "Authorization": "Bearer test_token" },
            "pathParams": { "tableId": 9999, "viewId": "active_projects" }
          }
        },
        "assertions": [
          {
            "description": "Returns 404 when table does not exist",
            "expectedStatus": 404,
            "expectedSchema": {
              "type": "object",
              "properties": {
                "error": { "type": "string" },
                "code": { "type": "string" }
              },
              "required": ["error"]
            },
            "validateResponseData": {
              "error": "Table not found",
              "code": "TABLE_NOT_FOUND"
            }
          }
        ]
      }
    },
    {
      "id": "API-TABLES-VIEWS-GET-004",
      "given": "A view with filters, sorts, and groupBy configured",
      "when": "User requests view details",
      "then": "All view properties including filters, sorts, and groupBy should be included in response",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE projects (id SERIAL PRIMARY KEY, status VARCHAR(50), priority INTEGER, archived BOOLEAN DEFAULT FALSE)"
          ],
          "tableConfig": {
            "id": 1,
            "name": "projects",
            "views": [
              {
                "id": "status_board",
                "name": "Status Board",
                "type": "kanban",
                "groupBy": { "field": "status", "direction": "asc" },
                "filters": {
                  "operator": "AND",
                  "conditions": [{ "field": "archived", "operator": "isFalse" }]
                },
                "isDefault": false
              }
            ]
          },
          "apiRequest": {
            "method": "GET",
            "endpoint": "/api/tables/1/views/status_board",
            "headers": { "Authorization": "Bearer test_token" },
            "pathParams": { "tableId": 1, "viewId": "status_board" }
          }
        },
        "assertions": [
          {
            "description": "Returns view with all properties (filters, groupBy)",
            "expectedStatus": 200,
            "expectedSchema": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "type": { "type": "string" },
                "groupBy": { "type": "object" },
                "filters": { "type": "object" }
              },
              "required": ["id", "name", "type", "groupBy", "filters"]
            },
            "validateResponseData": {
              "type": "kanban",
              "groupBy.field": "status"
            }
          }
        ]
      }
    },
    {
      "id": "API-TABLES-VIEWS-GET-005",
      "given": "A calendar view with field configurations",
      "when": "User requests view details",
      "then": "Fields array with visibility and order should be included in response",
      "validation": {
        "setup": {
          "executeQuery": [
            "CREATE TABLE projects (id SERIAL PRIMARY KEY, name VARCHAR(255), start_date DATE, end_date DATE)"
          ],
          "tableConfig": {
            "id": 1,
            "name": "projects",
            "views": [
              {
                "id": "project_timeline",
                "name": "Project Timeline",
                "type": "calendar",
                "fields": [
                  { "name": "name", "visible": true, "order": 1 },
                  { "name": "start_date", "visible": true, "order": 2 },
                  { "name": "end_date", "visible": true, "order": 3 }
                ],
                "sorts": [{ "field": "start_date", "direction": "asc" }],
                "isDefault": false
              }
            ]
          },
          "apiRequest": {
            "method": "GET",
            "endpoint": "/api/tables/1/views/project_timeline",
            "headers": { "Authorization": "Bearer test_token" },
            "pathParams": { "tableId": 1, "viewId": "project_timeline" }
          }
        },
        "assertions": [
          {
            "description": "Returns view with fields array configuration",
            "expectedStatus": 200,
            "expectedSchema": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "type": { "type": "string" },
                "fields": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": { "type": "string" },
                      "visible": { "type": "boolean" },
                      "order": { "type": "integer" }
                    },
                    "required": ["name", "visible", "order"]
                  }
                }
              },
              "required": ["id", "name", "type", "fields"]
            },
            "validateResponseData": {
              "type": "calendar",
              "fields.length": 3
            }
          }
        ]
      }
    }
  ]
}
