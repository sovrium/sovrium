{
  "$id": "static-deployment.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Static Site Generation - Deployment Features",
  "description": "Specifications for deployment features in static site generation (GitHub Pages support, SEO files, base path configuration)",
  "x-specs": [
    {
      "id": "STATIC-DEPLOY-001",
      "given": "a static site configured for GitHub Pages deployment",
      "when": "static site is generated with deployment: 'github-pages'",
      "then": ".nojekyll file should be created in output root to allow underscore-prefixed files and directories",
      "application": {
        "configuration": {
          "deployment": "github-pages",
          "outputDirectory": "dist/"
        },
        "expectedOutput": {
          "file": "dist/.nojekyll (empty file)",
          "purpose": "Disable Jekyll processing on GitHub Pages"
        },
        "useCases": [
          "GitHub Pages: Allow _next/, _app/, and other underscore-prefixed directories",
          "Jekyll bypass: Prevent GitHub from processing files with Jekyll",
          "Conditional: Only generate .nojekyll when deployment is 'github-pages'"
        ],
        "assertions": [
          "Create empty .nojekyll file in output root",
          "File must be present for GitHub Pages deployment",
          "Allow underscore-prefixed directories and files (_next/, _app/)",
          "Handle special GitHub Pages paths correctly",
          "Only generate when deployment is set to 'github-pages'"
        ]
      }
    },
    {
      "id": "STATIC-DEPLOY-002",
      "given": "a static site with multiple pages and SEO metadata",
      "when": "static site is generated",
      "then": "sitemap.xml should be generated with all public pages, priorities, and lastmod dates",
      "application": {
        "pages": [
          { "path": "/", "priority": 1.0, "lastmod": "2025-01-15" },
          { "path": "/about", "priority": 0.8, "lastmod": "2025-01-10" },
          { "path": "/contact", "priority": 0.6, "lastmod": "2025-01-05" },
          { "path": "/admin", "noindex": true }
        ],
        "expectedOutput": {
          "file": "dist/sitemap.xml",
          "format": "Valid XML with <?xml version=\"1.0\" encoding=\"UTF-8\"?> header",
          "schema": "xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\""
        },
        "expectedXML": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>https://example.com/</loc>\n    <priority>1.0</priority>\n    <changefreq>daily</changefreq>\n    <lastmod>2025-01-15</lastmod>\n  </url>\n  <url>\n    <loc>https://example.com/about</loc>\n    <priority>0.8</priority>\n    <lastmod>2025-01-10</lastmod>\n  </url>\n</urlset>",
        "useCases": [
          "SEO: Help search engines discover all pages",
          "Priority: Indicate important pages (1.0 = highest)",
          "Changefreq: Signal update frequency (daily, weekly, monthly)",
          "Noindex exclusion: Skip /admin and other private pages"
        ],
        "assertions": [
          "Generate valid XML sitemap with proper schema",
          "Include all public pages with their URLs",
          "Exclude pages marked with noindex",
          "Add priority and changefreq values from meta",
          "Include lastmod dates for all URLs"
        ]
      }
    },
    {
      "id": "STATIC-DEPLOY-003",
      "given": "a static site with pages and sitemap configuration",
      "when": "static site is generated",
      "then": "robots.txt should be created with User-agent rules and sitemap reference",
      "application": {
        "pages": [
          { "path": "/", "indexable": true },
          { "path": "/about", "indexable": true },
          { "path": "/admin", "noindex": true },
          { "path": "/api", "nofollow": true }
        ],
        "configuration": {
          "baseUrl": "https://example.com",
          "crawlDelay": 1
        },
        "expectedOutput": {
          "file": "dist/robots.txt",
          "format": "Text file with User-agent directives"
        },
        "expectedContent": "User-agent: *\nAllow: /\nAllow: /about\nDisallow: /admin\nDisallow: /api\nSitemap: https://example.com/sitemap.xml\nCrawl-delay: 1",
        "useCases": [
          "Search engines: Control crawling behavior",
          "Allow public pages: / and /about",
          "Disallow private pages: /admin and /api",
          "Sitemap reference: Point crawlers to sitemap.xml",
          "Crawl delay: Optional rate limiting for bots"
        ],
        "assertions": [
          "Create robots.txt with User-agent rules",
          "Allow crawling of public pages by default",
          "Disallow pages with noindex/nofollow meta",
          "Include sitemap URL reference",
          "Support custom crawl delay if configured"
        ]
      }
    },
    {
      "id": "STATIC-DEPLOY-004",
      "given": "a static site configured for subdirectory deployment (basePath: /docs)",
      "when": "static site is generated",
      "then": "all internal links and asset references should be prefixed with base path",
      "application": {
        "configuration": {
          "basePath": "/docs",
          "baseUrl": "https://example.com"
        },
        "pages": [
          { "path": "/", "links": ["/about", "/contact"] },
          { "path": "/about", "images": ["/logo.png"] }
        ],
        "expectedOutput": {
          "rootPage": {
            "canonical": "<link rel=\"canonical\" href=\"https://example.com/docs/\">",
            "navLinks": "<a href=\"/docs/about\">About</a>, <a href=\"/docs/contact\">Contact</a>",
            "assets": "<link href=\"/docs/assets/output.css\">"
          },
          "aboutPage": {
            "canonical": "<link rel=\"canonical\" href=\"https://example.com/docs/about\">",
            "image": "<img src=\"/docs/logo.png\">",
            "script": "<script src=\"/docs/assets/client.js\">"
          }
        },
        "useCases": [
          "Subdirectory deployment: Deploy to https://example.com/docs/",
          "GitHub Pages with repo name: /repo-name base path",
          "Multi-site hosting: /app1, /app2 on same domain",
          "CDN subpaths: Serve from /static subdirectory"
        ],
        "assertions": [
          "Prefix all internal links with base path (/docs/about)",
          "Update asset references with base path (/docs/assets/output.css)",
          "Adjust image and script src attributes (/docs/logo.png)",
          "Update canonical and hreflang URLs (https://example.com/docs/)",
          "Support subdirectory deployment correctly"
        ]
      }
    },
    {
      "id": "STATIC-DEPLOY-005",
      "given": "a static site configured for GitHub Pages with custom domain",
      "when": "static site is generated with deployment: 'github-pages' and baseUrl contains custom domain (not github.io)",
      "then": "CNAME file should be created in output root with the extracted domain name",
      "application": {
        "configuration": {
          "deployment": "github-pages",
          "baseUrl": "https://sovrium.com",
          "outputDirectory": "dist/"
        },
        "expectedOutput": {
          "file": "dist/CNAME",
          "content": "sovrium.com",
          "purpose": "Configure custom domain for GitHub Pages"
        },
        "useCases": [
          "Custom domain: Deploy to custom domain instead of username.github.io",
          "Domain extraction: Extract domain from baseUrl (remove protocol and path)",
          "Conditional: Only generate CNAME for custom domains (not *.github.io URLs)",
          "GitHub Pages: Configure custom domain automatically"
        ],
        "assertions": [
          "Create CNAME file in output root with domain name only",
          "Extract domain from baseUrl (e.g., https://sovrium.com â†’ sovrium.com)",
          "No protocol, no path, no trailing whitespace in CNAME content",
          "Only generate when deployment is 'github-pages' and baseUrl is custom domain",
          "Do NOT generate CNAME for *.github.io URLs (default GitHub Pages domains)"
        ]
      }
    },
    {
      "id": "STATIC-DEPLOY-006",
      "given": "a static site with pages including underscore-prefixed paths",
      "when": "static site is generated",
      "then": "underscore-prefixed pages (/_admin, /_api, etc.) should be excluded from HTML generation but listed in robots.txt disallow rules",
      "application": {
        "configuration": {
          "pages": [
            { "path": "/", "title": "Home" },
            { "path": "/about", "title": "About" },
            { "path": "/_admin", "title": "Admin", "robots": "noindex" },
            { "path": "/_api", "title": "API", "robots": "noindex" }
          ]
        },
        "expectedOutput": {
          "generated": ["index.html", "about.html"],
          "excluded": ["_admin.html", "_api.html"],
          "robotsTxt": "Disallow: /_admin\nDisallow: /_api"
        },
        "useCases": [
          "Admin panels: Exclude /_admin from static generation",
          "Internal APIs: Exclude /_api routes from static site",
          "GitHub Pages: .nojekyll allows underscore files but we skip generation",
          "SEO: Add underscore paths to robots.txt disallow list",
          "Security: Prevent static generation of internal/admin pages"
        ],
        "assertions": [
          "Do NOT generate HTML files for pages with underscore-prefixed paths",
          "Add underscore-prefixed paths to robots.txt Disallow rules",
          "Skip underscore pages during sitemap generation",
          "Apply exclusion consistently across single and multi-language modes",
          "Underscore pages with noindex should appear in robots.txt disallow"
        ]
      }
    }
  ]
}
