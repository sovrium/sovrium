{
  "$id": "static-hydration.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Static Site Generation - Progressive Enhancement",
  "description": "Specifications for progressive enhancement and hydration in static site generation (JavaScript-free HTML, React hydration, client bundles, component manifests)",
  "x-specs": [
    {
      "id": "STATIC-HYDRATION-001",
      "given": "a static site with hydration disabled",
      "when": "static site is generated without hydration configuration",
      "then": "HTML should work completely without JavaScript (no client bundles, forms use standard HTML submission)",
      "application": {
        "configuration": {
          "hydration": false,
          "pages": [
            {
              "path": "/",
              "sections": [
                { "type": "h1", "children": ["Welcome"] },
                { "type": "p", "children": ["Static content"] },
                {
                  "type": "form",
                  "props": { "method": "POST", "action": "/api/contact" },
                  "children": [
                    { "type": "input", "props": { "name": "email", "type": "email" } },
                    { "type": "button", "props": { "type": "submit" }, "children": ["Submit"] }
                  ]
                },
                { "type": "a", "props": { "href": "/about" }, "children": ["About"] }
              ]
            }
          ]
        },
        "expectedOutput": {
          "files": ["dist/index.html"],
          "noJavaScript": "No client.js or vendor.js files generated"
        },
        "expectedHTML": "<!DOCTYPE html>\n<html>\n<head><title>Home</title></head>\n<body>\n  <h1>Welcome</h1>\n  <p>Static content</p>\n  <form method=\"POST\" action=\"/api/contact\">\n    <input name=\"email\" type=\"email\">\n    <button type=\"submit\">Submit</button>\n  </form>\n  <a href=\"/about\">About</a>\n  <!-- No <script> tags -->\n</body>\n</html>",
        "useCases": [
          "Progressive enhancement: Site works without JavaScript",
          "Static content sites: Blogs, documentation, landing pages",
          "Form submission: Standard HTML POST to /api/contact",
          "Navigation: Regular anchor links (no client-side routing)",
          "Accessibility: Fully usable for users with JS disabled"
        ],
        "assertions": [
          "All content must be visible without JavaScript",
          "Forms should work with standard HTML submission",
          "Navigation links should function as regular anchors",
          "No JavaScript files generated when hydration is disabled",
          "Page should be fully accessible and usable"
        ]
      }
    },
    {
      "id": "STATIC-HYDRATION-002",
      "given": "a static site with hydration enabled and React components",
      "when": "static site is generated with interactive components",
      "then": "HTML should include data-component attributes and reference client.js bundle for hydration",
      "application": {
        "configuration": {
          "hydration": true,
          "pages": [
            {
              "path": "/",
              "sections": [
                { "type": "h1", "children": ["Welcome"] },
                {
                  "type": "Counter",
                  "hydrate": true,
                  "props": { "initialCount": 0 },
                  "children": []
                }
              ]
            }
          ]
        },
        "expectedOutput": {
          "files": ["dist/index.html", "dist/assets/client.js"],
          "htmlAttributes": "data-component, data-props on interactive elements"
        },
        "expectedHTML": "<!DOCTYPE html>\n<html>\n<head><title>Home</title></head>\n<body>\n  <h1>Welcome</h1>\n  <div data-component=\"Counter\" data-props='{\"initialCount\":0}'>\n    <button>Count: 0</button>\n  </div>\n  <div id=\"__SOVRIUM_HYDRATION_ROOT__\"></div>\n  <script type=\"module\" src=\"/assets/client.js\"></script>\n</body>\n</html>",
        "useCases": [
          "Interactive components: Counter, form validation, animations",
          "Hydration root: React attaches to data-component elements",
          "Props serialization: Component configuration in data-props",
          "Progressive enhancement: Static HTML + client-side React"
        ],
        "assertions": [
          "Add data-component attributes to hydratable elements",
          "Include data-props with component configuration",
          "Generate client.js bundle with hydration code",
          "Reference client bundle in HTML with module script tag",
          "Include React hydration root element"
        ]
      }
    },
    {
      "id": "STATIC-HYDRATION-003",
      "given": "a static site with multiple interactive components",
      "when": "static site is generated with client-side JavaScript enabled",
      "then": "client.js bundle should include all interactive components with optimizations (code splitting, vendor bundles)",
      "application": {
        "configuration": {
          "hydration": true,
          "components": ["Counter", "ContactForm", "ImageCarousel", "SearchBar"]
        },
        "expectedOutput": {
          "files": [
            "dist/assets/client.js (application code)",
            "dist/assets/vendor.js (React, libraries)",
            "dist/assets/Counter-[hash].js (code split)",
            "dist/assets/ContactForm-[hash].js (code split)"
          ],
          "bundling": "ES modules format for modern browsers"
        },
        "useCases": [
          "Code splitting: Load Counter.js only when Counter component visible",
          "Vendor bundle: React and libraries separated for caching",
          "Bundle optimization: Tree shaking, minification, compression",
          "Modern browsers: ES modules (import/export) format"
        ],
        "assertions": [
          "Bundle all interactive components into client.js",
          "Support code splitting for optimization",
          "Generate vendor bundle for libraries if needed",
          "Keep bundle sizes optimized and reasonable",
          "Use ES modules format for modern browsers"
        ]
      }
    },
    {
      "id": "STATIC-HYDRATION-004",
      "given": "a static site with various hydration strategies (eager, lazy, visible)",
      "when": "static site is generated with component manifest",
      "then": "manifest.json should track hydration strategy, component metadata, and page usage",
      "application": {
        "configuration": {
          "components": [
            { "name": "Counter", "hydration": "eager", "pages": ["/"] },
            { "name": "ContactForm", "hydration": "lazy", "pages": ["/contact"] },
            { "name": "ImageCarousel", "hydration": "visible", "pages": ["/", "/gallery"] }
          ]
        },
        "expectedOutput": {
          "file": "dist/assets/manifest.json"
        },
        "expectedManifest": "{\n  \"components\": [\n    {\n      \"name\": \"Counter\",\n      \"hydration\": \"eager\",\n      \"pages\": [\"/\"],\n      \"props\": { \"initialCount\": 0 },\n      \"bundlePath\": \"/assets/Counter-abc123.js\"\n    },\n    {\n      \"name\": \"ContactForm\",\n      \"hydration\": \"lazy\",\n      \"pages\": [\"/contact\"],\n      \"props\": { \"action\": \"/api/contact\" },\n      \"bundlePath\": \"/assets/ContactForm-def456.js\"\n    },\n    {\n      \"name\": \"ImageCarousel\",\n      \"hydration\": \"visible\",\n      \"pages\": [\"/\", \"/gallery\"],\n      \"props\": { \"images\": [] },\n      \"bundlePath\": \"/assets/ImageCarousel-ghi789.js\"\n    }\n  ]\n}",
        "useCases": [
          "Eager hydration: Counter loads immediately on page load",
          "Lazy hydration: ContactForm loads when user interacts",
          "Visible hydration: ImageCarousel loads when scrolled into view",
          "Page mapping: Track which components used on which pages",
          "Bundle references: Map component to code-split bundle path"
        ],
        "assertions": [
          "Create manifest.json with component metadata",
          "Track hydration strategy for each component (eager/lazy/visible)",
          "Map components to pages where they're used",
          "Include component props and configuration",
          "Reference manifest in client bundle for hydration"
        ]
      }
    }
  ]
}
